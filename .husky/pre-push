#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

set -eu

run_check() {
	npm run pre-push-check
}

export PATH="/usr/local/bin:/usr/bin:/bin:$PATH"

if command -v npm >/dev/null 2>&1; then
	run_check
	exit $?
fi

if command -v node >/dev/null 2>&1; then
	NODE_BIN="$(command -v node)"
	NPM_BIN="$(dirname "$NODE_BIN")/npm"
	if [ -x "$NPM_BIN" ]; then
		"$NPM_BIN" run pre-push-check
		exit $?
	fi
fi

export NVM_DIR="$HOME/.nvm"
if [ -s "$NVM_DIR/nvm.sh" ]; then
	. "$NVM_DIR/nvm.sh"
fi

if command -v fnm >/dev/null 2>&1; then
	eval "$(fnm env --use-on-cd)"
fi

if [ -s "$HOME/.asdf/asdf.sh" ]; then
	. "$HOME/.asdf/asdf.sh"
fi

if [ -s "$HOME/.volta/load.sh" ]; then
	. "$HOME/.volta/load.sh"
fi

if command -v npm >/dev/null 2>&1; then
	run_check
	exit $?
fi

if [ -n "${SHELL:-}" ]; then
	"$SHELL" -lc "npm run pre-push-check"
	exit $?
fi

echo "npm not found in PATH. Ensure Node is available in git hooks."
echo "PATH=$PATH"
echo "node=$(command -v node || true)"
exit 1
